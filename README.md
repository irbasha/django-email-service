﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿# django-email-serviceThis is a simple django application which allows you to send email to a single user or multiple users.This guide will walk you through the installation procedure on Ubuntu 18.04 Server. # Prerequisites:- Python3- Django v2.1- Java v8 or above- ELK Stack# InstallationHere, Installation is divided in to two sections.  - Setting up ELK Stack - Installing ApplicationFirst, we will install and setup ELK Stack for application's log management and then we we will focus on application installation.### Setting up ELK StackThe following steps are applicable only for Ubuntu/Debian flavours. For CentOS/RedHat please follow instructions from official website.[Elasticsearch](https://www.elastic.co/downloads/elasticsearch), [Logstash](https://www.elastic.co/downloads/logstash), [Kibana](https://www.elastic.co/downloads/kibana).- Login as a root user```$ sudo su```- Install Java version 8 or above```$ sudo apt install default-jre```- Verify java version.```$ java --version```- Download and Install Public Signing Key```$ wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -```- Adding APT repository for ELK```$ sudo apt-get install apt-transport-https$ echo "deb https://artifacts.elastic.co/packages/7.x/apt stable main" | sudo tee -a /etc/apt/sources.list.d/elastic-7.x.list```- Update System```$ sudo apt-get update```##### Elastic Search- Install Elastic Search```$ sudo apt-get install elasticsearch -y```- Start and Enable Elastic Search```$ systemctl daemon-reload$ systemctl enable elasticsearch$ systemctl start elasticsearch```- Configure firewall to allow port access for elasticsearch```$ firewall-cmd --add-port=9200/tcp$ firewall-cmd --add-port=9200/tcp --permanent ```- Verify logstash service is running properly```$ curl -X GET http://localhost:9200```- Output:```	{		"name" : "master",		"cluster_name" : "logmanager",		"cluster_uuid" : "sdcteHG4SUaZuM-Q8b6_Ag",		"version" : {			"number" : "2.4.2",			"build_hash" : "161c65a337d4b422ac0c805f284565cf2014bb84",			"build_timestamp" : "2016-11-17T11:51:03Z",			"build_snapshot" : false,			"lucene_version" : "5.5.2"		},		"tagline" : "You Know, for Search"	}```- For UI Install elasticsearch-head : https://mobz.github.io/elasticsearch-head/##### Logstash- Install logstash```$ sudo apt-get install logstash -y```- Configure logstash. Create `logstash.conf` file under `/etc/logstash/` folder,```$ vim /etc/logstash/logstash.conf``` and add the following code. Make note of the port `5044` used here, we will use the same port in django settings. If changed here, also make sure to change it in django project's `settings.py` file for `LOGGING` section.```	input{	 file{	   path => "/tmp/debug.log"	 }	}	filter{	 grok{	   match => {"message" => "%{TIMESTAMP_ISO8601:timestamp} %{LOGLEVEL:log-level} %{GREEDYDATA:message}"}	 }	}	output{	  elasticsearch { hosts => ["localhost:9200"] index => "index_name" }	  stdout { codec => rubydebug }	}```- Start and enable logstash service```$ systemctl daemon-reload$ systemctl start logstash$ systemctl enable logstash```##### Kibana- Install Kibana```$ sudo apt-get install kibana -y```- Start and Enable Kibana```$ systemctl daemon-reload$ systemctl start kibana$ systemctl enable kibana```- Configure firewall to allow port access for Kibana```$ firewall-cmd --add-port=5601/tcp$ firewall-cmd --add-port=5601/tcp --permanent```- Increase the file limits to get performance. Add below lines to /etc/security/limits.conf.```	*        soft   nofile   64000	*        hard   nofile   64000	root     soft   nofile   64000	root     hard   nofile   64000```- Reboot the system to take effect.```$ reboot```### Install Application- Install python's vitualenv package using pip```$ pip3 install virtualenv```- Create a Virtual Environment and activate it. Here, `py3env` is the name we are giving for the virtual environment. You can give your own different name.```$ virtualenv -p /usr/bin/python3 py3env$ source py3env/bin/activate```- Set Environment variables for django to read emailid and password for your gmail account. Our application will use your Gmail Account to trigger email id.```$ export EMAIL_USER='<YOUR GMAIL ACCOUNT EMAIL ID HERE>' && export EMAIL_AUTH='<PASSWORD HERE>'```- Download our Software Package `django-email-service` from the link shared seperately- Unzip the Folder```$ unzip django-email-service```- Install Application requirements from `requirements.txt` available in django-email-service folder```$ cd django-email-service/$ pip3 install requirements.txt```- Move to EmailService directory which is our django project```$ cd EmailService/```- Create superuser account. Will be used for managing application and receive statistics report. Please provide valid username, emailid and a strong password. Same emailid will be used for generating statistics reports.```$ python manage.py createsuperuser```- Migrate and apply the fresh changes```$ python manage.py makemigrations$ python manage.py migrate```- Run Django Server. If you are hosting the application on cloud machine make sure to the ip in django's settings.py file in ALLOWED_HOST list.```$ python manage.py runserver <ipaddress>:<port>```- In the other terminal, run logstash with logstash configuration.```$ cd /path/to/logstash/executable/bin/folder$ ./logstash -f /etc/logstash/logstash.conf```# Instructions for use- Access the application from browser with the url `http://localhost:8000`. Make sure of giving public ip or domain name if hosted on cloud.- Login with admin credentials or create an user account with signup option if needed.- Once logged in, use the compose email form available to send email to any user, it supports multiple email to multipls users too. It also supports email's bcc and cc feature.- You can also upload csv file with list of email ids to send email to all users.- Verify all the information and error logs logs from kibana dashboard. Go to Kibana dashoard by accessing the url `http://localhost:5601` and view all the logs.- This application also sends statistics report to the admin email id every 30 minutes. Email Id configured while creating superuser account.# Release History